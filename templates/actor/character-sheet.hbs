<section class="sheet-body">
  <div class="grid-2">
    <div>
      <div class="card">
        <div class="card-title">Estadísticas</div>
        <table>
          <thead>
            <tr>
              <th>VAL</th><th>BON</th><th>Origen</th><th>Atributo</th>
            </tr>
          </thead>
          <tbody>
            {{#each system.stats as |s k|}}
            <tr>
              <td><input class="tiny" type="number" name="system.stats.{{k}}.valor" value="{{s.valor}}"></td>
              <td><input class="tiny" type="number" name="system.stats.{{k}}.bono" value="{{s.bono}}"></td>
              <td><input class="tiny" type="number" name="system.stats.{{k}}.origen" value="{{s.origen}}"></td>
              <td style="text-align:left;">{{k}}</td>
            </tr>
            {{/each}}
          </tbody>
        </table>
        <div class="flex muted">
          <div>Expericia:</div>
          <input class="tiny" type="number" name="system.experticia" value="{{system.experticia}}">
          <div>Nivel:</div>
          <input class="tiny" type="number" name="system.nivel" value="{{system.nivel}}">
        </div>
      </div>

      <div class="card">
        <div class="card-title">Vida &amp; Energía</div>
        <div class="grid-2">
          <div>
            <div>Vida</div>
            <div class="flex">
              <input type="number" name="system.vida.actual" value="{{system.vida.actual}}">
              <span>/</span>
              <input type="number" name="system.vida.total"  value="{{system.vida.total}}">
            </div>
          </div>
          <div>
            <div>Energía</div>
            <div class="flex">
              <input type="number" name="system.energia.actual" value="{{system.energia.actual}}">
              <span>/</span>
              <input type="number" name="system.energia.total"  value="{{system.energia.total}}">
            </div>
          </div>
        </div>
        <div class="muted">Bonus Durable: {{system.vida.bonusDurable}}</div>
      </div>

      <div class="card">
        <div class="card-title">Armas</div>
        {{#each system.armas as |a i|}}
        <div class="grid-4" style="margin-bottom:.35rem;">
          <input name="system.armas.{{i}}.nombre" value="{{a.nombre}}" placeholder="Nombre">
          <input name="system.armas.{{i}}.dado"   value="{{a.dado}}" placeholder="1d6">
          <select name="system.armas.{{i}}.stat.key">
            {{#each ../system.stats as |s k|}}
              <option value="{{k}}" {{#if (eq a.stat.key k)}}selected{{/if}}>{{k}}</option>
            {{/each}}
          </select>
          <input name="system.armas.{{i}}.precision" type="number" value="{{a.precision}}" placeholder="Precisión">
          <input name="system.armas.{{i}}.efectos" value="{{a.efectos}}" placeholder="Efectos" style="grid-column: span 2;">
          <button class="btn" type="button" data-action="roll-ataque" data-index="{{i}}">Ataque</button>
        </div>
        {{/each}}
        <button class="btn" type="button" data-action="add-arma">+ Arma</button>
      </div>
    </div>

    <div>
      <div class="card">
        <div class="card-title">Evasión Total</div>
        <div class="grid-3">
          <div class="salv-box">
            <label>Base</label>
            <input class="tiny" type="number" name="system.evasiones.base" value="{{system.evasiones.base}}">
          </div>
          <div class="salv-box">
            <label>Reflejos</label>
            <div class="salv-total">{{system.salvaciones.reflejos.total}}</div>
          </div>
          <div class="salv-box">
            <label>Total</label>
            <div class="salv-total">{{system.evasiones.total}}</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Salvaciones</div>
        <div class="salv-grid">
          <div class="salv-box">
            <label>Fortaleza</label>
            <input class="tiny" type="number" name="system.salvaciones.fortaleza.bonoEspecial" value="{{system.salvaciones.fortaleza.bonoEspecial}}">
          </div>
          <div class="salv-box">
            <label>Reflejos</label>
            <input class="tiny" type="number" name="system.salvaciones.reflejos.bonoEspecial" value="{{system.salvaciones.reflejos.bonoEspecial}}">
          </div>
          <div class="salv-box">
            <label>Voluntad</label>
            <input class="tiny" type="number" name="system.salvaciones.voluntad.bonoEspecial" value="{{system.salvaciones.voluntad.bonoEspecial}}">
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">HABILIDADES NATURALES</div>
        <table>
          <thead><tr><th>Habilidad</th><th>Origen</th><th>Rangos</th><th>Extra</th><th>Total</th></tr></thead>
          <tbody>
            {{#each system.habilidadesNaturales as |h i|}}
            <tr>
              <td style="text-align:left;">{{h.nombre}}</td>
              <td><input class="tiny" type="number" name="system.habilidadesNaturales.{{i}}.origen" value="{{h.origen}}"></td>
              <td><input class="tiny" type="number" name="system.habilidadesNaturales.{{i}}.rangos" value="{{h.rangos}}"></td>
              <td><input class="tiny" type="number" name="system.habilidadesNaturales.{{i}}.extra" value="{{h.extra}}"></td>
              <td>{{h.total}}</td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      <div class="card">
        <div class="card-title">Disciplinas</div>
        <table>
          <thead><tr><th>Disciplina</th><th>Dado</th><th>Origen</th><th>Rangos</th><th>Extra</th><th>D</th><th>I</th><th>C</th><th></th></tr></thead>
          <tbody>
            {{#each system.disciplinas as |d k|}}
            <tr>
              <td style="text-align:left;">{{k}}</td>
              <td><input class="tiny" name="system.disciplinas.{{k}}.dado" value="{{d.dado}}"></td>
              <td><input class="tiny" type="number" name="system.disciplinas.{{k}}.origen" value="{{d.origen}}"></td>
              <td><input class="tiny" type="number" name="system.disciplinas.{{k}}.rangos" value="{{d.rangos}}"></td>
              <td><input class="tiny" type="number" name="system.disciplinas.{{k}}.especial" value="{{d.especial}}"></td>
              <td>{{d.totalD}}</td>
              <td>{{d.totalI}}</td>
              <td>{{d.totalC}}</td>
              <td>
                <button class="btn" type="button" data-action="roll-disc" data-key="{{k}}" data-canal="D">D</button>
                <button class="btn" type="button" data-action="roll-disc" data-key="{{k}}" data-canal="I">I</button>
                <button class="btn" type="button" data-action="roll-disc" data-key="{{k}}" data-canal="C">C</button>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>