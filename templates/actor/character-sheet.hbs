
<form class="{{cssClass}} sheet-body hxh" autocomplete="off">
  <div class="grid-2">
    <!-- Columna izquierda -->
    <div>
      <div class="panel">
        <div class="title">Estad√≠sticas</div>
        <table>
          <thead><tr><th>VAL</th><th>BON</th><th>Origen</th><th>Atributo</th><th>Progresi√≥n</th><th>üé≤</th></tr></thead>
          <tbody>
            {{#each system.stats as |s k|}}
            <tr>
              <td><input id="stat-{{k}}-val" class="tiny" name="system.stats.{{k}}.valor" type="number" value="{{s.valor}}"></td>
              <td><input id="stat-{{k}}-bon" class="tiny" name="system.stats.{{k}}.bono"  type="number" value="{{s.bono}}"></td>
              <td><input id="stat-{{k}}-ori" class="tiny" name="system.stats.{{k}}.origen"type="number" value="{{s.origen}}"></td>
              <td style="text-align:left;"><label for="stat-{{k}}-val">{{k}}</label></td>
              <td>
                <div class="pips">
                  {{#times s.origen}}<div class="pip on"></div>{{/times}}
                  {{#times (subtract 20 s.origen)}}<div class="pip"></div>{{/times}}
                </div>
              </td>
              <td class="rollcell"><button aria-label="Tirar {{k}}" type="button" class="btn" data-action="roll-stat" data-key="{{k}}">üé≤</button></td>
            </tr>
            {{/each}}
          </tbody>
        </table>
        <div class="row">
          <label for="xp">Expericia:</label><input id="xp" class="tiny" name="system.experticia" type="number" value="{{system.experticia}}">
          <label for="nivel">Nivel:</label><input id="nivel" class="tiny" name="system.progreso.nivel" type="number" value="{{system.progreso.nivel}}">
          <label for="init">Iniciativa:</label><input id="init" class="tiny" name="system.iniciativa" type="number" value="{{system.iniciativa}}">
        </div>
      </div>

      <div class="panel">
        <div class="title">Vida &amp; Energ√≠a</div>
        <div class="grid-2">
          <div>
            <label for="vida-act">Vida</label>
            <div class="row">
              <input id="vida-act" name="system.vida.actual" type="number" value="{{system.vida.actual}}"><span>/</span>
              <input id="vida-tot" name="system.vida.total"  type="number" value="{{system.vida.total}}">
            </div>
          </div>
          <div>
            <label for="ene-act">Energ√≠a</label>
            <div class="row">
              <input id="ene-act" name="system.energia.actual" type="number" value="{{system.energia.actual}}"><span>/</span>
              <input id="ene-tot" name="system.energia.total"  type="number" value="{{system.energia.total}}">
            </div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="title">Armas</div>
        {{#each system.armas as |a i|}}
          <div class="grid-4" style="margin-bottom:.35rem;">
            <input name="system.armas.{{i}}.nombre" value="{{a.nombre}}" placeholder="Nombre">
            <input name="system.armas.{{i}}.dado"   value="{{a.dado}}"   placeholder="1d6">
            <select name="system.armas.{{i}}.stat.key">
              {{#each ../system.stats as |s k|}}<option value="{{k}}" {{#if (eq ../a.stat.key k)}}selected{{/if}}>{{k}}</option>{{/each}}
            </select>
            <input name="system.armas.{{i}}.precision" type="number" value="{{a.precision}}" placeholder="Precisi√≥n">
            <select name="system.armas.{{i}}.tipo">
              <option {{#if (eq a.tipo "Contundente")}}selected{{/if}}>Contundente</option>
              <option {{#if (eq a.tipo "Perforante")}}selected{{/if}}>Perforante</option>
              <option {{#if (eq a.tipo "Cortante")}}selected{{/if}}>Cortante</option>
            </select>
            <select name="system.armas.{{i}}.extremidad">
              <option {{#if (eq a.extremidad "Brazo Derecho")}}selected{{/if}}>Brazo Derecho</option>
              <option {{#if (eq a.extremidad "Brazo Izquierdo")}}selected{{/if}}>Brazo Izquierdo</option>
              <option {{#if (eq a.extremidad "Ambas Manos")}}selected{{/if}}>Ambas Manos</option>
            </select>
            <input style="grid-column: span 3;" name="system.armas.{{i}}.efectos" value="{{a.efectos}}" placeholder="Efectos">
            <div class="rollcell">
              <button type="button" class="btn" data-action="roll-ataque" data-index="{{i}}">‚öîÔ∏è</button>
              <button type="button" class="btn" data-action="del-arma" data-index="{{i}}">‚úñ</button>
            </div>
          </div>
        {{/each}}
        <button type="button" class="btn" data-action="add-arma">+ Arma</button>
      </div>

      <div class="panel">
        <div class="title">Accesorios</div>
        <table>
          <thead><tr><th>#</th><th>Accesorio</th><th>Nota</th><th>Cargas</th><th></th></tr></thead>
          <tbody>
            {{#each system.accesorios as |ac i|}}
            <tr>
              <td>{{increment i}}</td>
              <td><input name="system.accesorios.{{i}}.nombre" value="{{ac.nombre}}"></td>
              <td><input name="system.accesorios.{{i}}.nota" value="{{ac.nota}}"></td>
              <td><input class="tiny" name="system.accesorios.{{i}}.cargas" value="{{ac.cargas}}"></td>
              <td class="rollcell"><button class="btn" type="button" data-action="del-acc" data-index="{{i}}">‚úñ</button></td>
            </tr>
            {{/each}}
          </tbody>
        </table>
        <div class="table-controls"><button type="button" class="btn" data-action="add-acc">+ Accesorio</button></div>
      </div>

      <div class="panel">
        <div class="title">Inventario</div>
        <div class="row"><label for="money">Dinero</label><input id="money" class="tiny" name="system.inventario.dinero" type="number" value="{{system.inventario.dinero}}"></div>
        <table>
          <thead><tr><th>Mochila</th><th>Cantidad</th><th></th></tr></thead>
          <tbody>
            {{#each system.inventario.mochila as |it i|}}
            <tr>
              <td><input name="system.inventario.mochila.{{i}}.item" value="{{it.item}}"></td>
              <td><input class="tiny" name="system.inventario.mochila.{{i}}.cantidad" type="number" value="{{it.cantidad}}"></td>
              <td class="rollcell"><button class="btn" type="button" data-action="del-item" data-index="{{i}}">‚úñ</button></td>
            </tr>
            {{/each}}
          </tbody>
        </table>
        <div class="table-controls"><button type="button" class="btn" data-action="add-item">+ Item</button></div>
      </div>
    </div>

    <!-- Columna derecha -->
    <div>
      <div class="panel">
        <div class="title">Evasi√≥n Total</div>
        <div class="grid-3">
          <div><label for="evbase">Base</label><input id="evbase" class="tiny" name="system.evasiones.base" type="number" value="{{system.evasiones.base}}"></div>
          <div><label>Reflejos</label><div>{{system.salvaciones.reflejos.total}}</div></div>
          <div><label>Total</label><div>{{system.evasiones.total}}</div></div>
        </div>
        <div style="margin-top:6px;">
          <table>
            <thead><tr><th>Nombre</th><th>V</th><th>SD</th><th>D</th><th>Valor</th><th></th></tr></thead>
            <tbody>
              {{#each system.evasiones.armaduras as |r i|}}
              <tr>
                <td><input name="system.evasiones.armaduras.{{i}}.nombre" value="{{r.nombre}}"></td>
                <td><input class="tiny" name="system.evasiones.armaduras.{{i}}.v" type="number" value="{{r.v}}"></td>
                <td><input class="tiny" name="system.evasiones.armaduras.{{i}}.sd" type="number" value="{{r.sd}}"></td>
                <td><input class="tiny" name="system.evasiones.armaduras.{{i}}.d" type="number" value="{{r.d}}"></td>
                <td><input class="tiny" name="system.evasiones.armaduras.{{i}}.valor" type="number" value="{{r.valor}}"></td>
                <td class="rollcell"><button type="button" class="btn" data-action="del-armadura" data-index="{{i}}">‚úñ</button></td>
              </tr>
              {{/each}}
            </tbody>
          </table>
          <button type="button" class="btn" data-action="add-armadura">+ Armadura</button>
        </div>
      </div>

      <div class="panel">
        <div class="title">Salvaciones</div>
        <table>
          <thead><tr><th>Tipo</th><th>Bono especial</th><th>Total</th><th>üé≤</th></tr></thead>
          <tbody>
            <tr><td style="text-align:left;">Fortaleza</td>
                <td><input class="tiny" name="system.salvaciones.fortaleza.bonoEspecial" type="number" value="{{system.salvaciones.fortaleza.bonoEspecial}}"></td>
                <td>{{system.salvaciones.fortaleza.total}}</td>
                <td class="rollcell"><button class="btn" data-action="roll-salv" data-key="fortaleza">üé≤</button></td></tr>
            <tr><td style="text-align:left;">Reflejos</td>
                <td><input class="tiny" name="system.salvaciones.reflejos.bonoEspecial" type="number" value="{{system.salvaciones.reflejos.bonoEspecial}}"></td>
                <td>{{system.salvaciones.reflejos.total}}</td>
                <td class="rollcell"><button class="btn" data-action="roll-salv" data-key="reflejos">üé≤</button></td></tr>
            <tr><td style="text-align:left;">Voluntad</td>
                <td><input class="tiny" name="system.salvaciones.voluntad.bonoEspecial" type="number" value="{{system.salvaciones.voluntad.bonoEspecial}}"></td>
                <td>{{system.salvaciones.voluntad.total}}</td>
                <td class="rollcell"><button class="btn" data-action="roll-salv" data-key="voluntad">üé≤</button></td></tr>
          </tbody>
        </table>
      </div>

      <div class="panel">
        <div class="title">HABILIDADES NATURALES</div>
        <table>
          <thead><tr><th>Habilidad</th><th>Origen</th><th>Rangos</th><th>Extra</th><th>Total</th><th>üé≤</th></tr></thead>
          <tbody>
            {{#each system.habilidadesNaturales as |h i|}}
            <tr>
              <td style="text-align:left;">{{h.nombre}}</td>
              <td><input class="tiny" name="system.habilidadesNaturales.{{i}}.origen" type="number" value="{{h.origen}}"></td>
              <td><input class="tiny" name="system.habilidadesNaturales.{{i}}.rangos" type="number" value="{{h.rangos}}"></td>
              <td><input class="tiny" name="system.habilidadesNaturales.{{i}}.extra"  type="number" value="{{h.extra}}"></td>
              <td>{{h.total}}</td>
              <td class="rollcell"><button class="btn" type="button" data-action="roll-hab" data-index="{{i}}">üé≤</button></td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      <div class="panel">
        <div class="title">Disciplinas</div>
        <table>
          <thead><tr><th>Disciplina</th><th>Dado</th><th>Origen</th><th>Rangos</th><th>Extra</th><th>D</th><th>I</th><th>C</th><th>üé≤</th></tr></thead>
          <tbody>
            {{#each system.disciplinas as |d k|}}
            <tr>
              <td style="text-align:left;">{{k}}</td>
              <td><input class="tiny" name="system.disciplinas.{{k}}.dado"   value="{{d.dado}}"></td>
              <td><input class="tiny" name="system.disciplinas.{{k}}.origen" type="number" value="{{d.origen}}"></td>
              <td><input class="tiny" name="system.disciplinas.{{k}}.rangos" type="number" value="{{d.rangos}}"></td>
              <td><input class="tiny" name="system.disciplinas.{{k}}.especial" type="number" value="{{d.especial}}"></td>
              <td>{{d.totalD}}</td><td>{{d.totalI}}</td><td>{{d.totalC}}</td>
              <td class="rollcell">
                <button class="btn" type="button" data-action="roll-disc" data-key="{{k}}" data-canal="D">D</button>
                <button class="btn" type="button" data-action="roll-disc" data-key="{{k}}" data-canal="I">I</button>
                <button class="btn" type="button" data-action="roll-disc" data-key="{{k}}" data-canal="C">C</button>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      <div class="panel">
        <div class="title">Talentos</div>
        <table>
          <thead><tr><th>Requisito</th><th>Talento</th></tr></thead>
          <tbody>
            {{#each system.talentos as |t i|}}
            <tr>
              <td> Nv {{t.nivel}} </td>
              <td><input name="system.talentos.{{i}}.nombre" value="{{t.nombre}}" {{#if (lt ../system.progreso.nivel t.nivel)}}disabled{{/if}}></td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      <div class="panel">
        <div class="title">Dotes</div>
        <table>
          <thead><tr><th>Requisito</th><th>Dote</th></tr></thead>
          <tbody>
            {{#each system.dotes as |d i|}}
            <tr>
              <td> Nv {{d.nivel}} </td>
              <td><input name="system.dotes.{{i}}.nombre" value="{{d.nombre}}" {{#if (lt ../system.progreso.nivel d.nivel)}}disabled{{/if}}></td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      <div class="panel">
        <div class="title">Meta &amp; Origen</div>
        <div class="grid-3">
          <div><label for="orig">Tipo de origen</label><input id="orig" name="system.identidad.origen" value="{{system.identidad.origen}}"></div>
          <div><label for="subo">Subtipo</label><input id="subo" name="system.identidad.subtipo" value="{{system.identidad.subtipo}}"></div>
          <div><label for="color">Color de cards</label><input id="color" name="system.identidad.color_cards" value="{{system.identidad.color_cards}}"></div>
        </div>
        <div class="grid-2" style="margin-top:6px;">
          <div>
            <label for="obj">Objetivo</label>
            <textarea id="obj" name="system.identidad.objetivo">{{system.identidad.objetivo}}</textarea>
          </div>
          <div>
            <label for="def">Defectos</label>
            <textarea id="def" name="system.identidad.defectos">{{system.identidad.defectos}}</textarea>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
