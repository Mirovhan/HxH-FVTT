<section class="sheet-body">
  <h2>Estadísticas</h2>
  <section class="stats grid">
    {{#each system.stats as |s statKey|}}
      <div class="stat">
        <label>{{localize (concat "hxh.stat." statKey)}}</label>
        <div class="flexrow">
          <input type="number" name="system.stats.{{statKey}}.valor" value="{{s.valor}}" placeholder="Valor"/>
          <input type="number" name="system.stats.{{statKey}}.bono"  value="{{s.bono}}"  placeholder="Bono"/>
        </div>
      </div>
    {{/each}}
  </section>

  <h2>Salvaciones</h2>
  <section class="salvaciones flexrow">
    {{> "systems/hxh-fvtt/templates/actor/partials/salv.hbs" salvKey="fortaleza"}}
    {{> "systems/hxh-fvtt/templates/actor/partials/salv.hbs" salvKey="reflejos"}}
    {{> "systems/hxh-fvtt/templates/actor/partials/salv.hbs" salvKey="voluntad"}}
  </section>

  <h2>Disciplinas</h2>
  <section class="disciplinas">
    {{#each system.disciplinas as |d k|}}
    <div class="disc-row">
      <h4>{{localize (concat "hxh.disc." k)}}</h4>
      <input name="system.disciplinas.{{k}}.dado"     value="{{d.dado}}">
      <input name="system.disciplinas.{{k}}.origen"   type="number" value="{{d.origen}}">
      <input name="system.disciplinas.{{k}}.rangos"   type="number" value="{{d.rangos}}">
      <input name="system.disciplinas.{{k}}.especial" type="number" value="{{d.especial}}">
      <button type="button" data-action="roll-disc" data-key="{{k}}" data-canal="D">D</button>
      <button type="button" data-action="roll-disc" data-key="{{k}}" data-canal="I">I</button>
      <button type="button" data-action="roll-disc" data-key="{{k}}" data-canal="C">C</button>
      <span class="totales">D={{d.totalD}} I={{d.totalI}} C={{d.totalC}}</span>
    </div>
    {{/each}}
  </section>

  <h2>Vida &amp; Energía</h2>
  <section class="flexrow">
    <div>
      <label>Vida</label>
      <input type="number" name="system.vida.actual" value="{{system.vida.actual}}"> /
      <input type="number" name="system.vida.total"  value="{{system.vida.total}}">
      <small>Bonus Durable: {{system.vida.bonusDurable}}</small>
    </div>
    <div style="margin-left:1rem;">
      <label>Energía</label>
      <input type="number" name="system.energia.actual" value="{{system.energia.actual}}"> /
      <input type="number" name="system.energia.total"  value="{{system.energia.total}}">
    </div>
  </section>

  <h2>Armas</h2>
  <section class="armas">
    {{#each system.armas as |a i|}}
    <div class="arma">
      <input name="system.armas.{{i}}.nombre" value="{{a.nombre}}" placeholder="Nombre del arma">
      <input name="system.armas.{{i}}.dado"   value="{{a.dado}}"   placeholder="d6/d8">
      <select name="system.armas.{{i}}.stat.key">
        {{#each ../system.stats as |s k|}}
          <option value="{{k}}" {{#if (eq a.stat.key k)}}selected{{/if}}>{{k}}</option>
        {{/each}}
      </select>
      <input name="system.armas.{{i}}.precision" type="number" value="{{a.precision}}">
      <input name="system.armas.{{i}}.efectos"   value="{{a.efectos}}" placeholder="Efectos">
      <button type="button" data-action="roll-ataque" data-index="{{i}}">Ataque</button>
    </div>
    {{/each}}
    <button type="button" data-action="add-arma">+ Arma</button>
  </section>
</section>