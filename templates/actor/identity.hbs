
<form class="hxh-form" autocomplete="off">
<section class="hxh-actor-root" data-actor-id="{{document.id}}">
  <header class="id-header">
    <div class="img-col">
      <figure class="portrait">
        <figcaption>Retrato (presentación)</figcaption>
        <img src="{{document.img}}" alt="Retrato"/>
        <div class="row">
          <input type="text" name="img" value="{{document.img}}" placeholder="ruta/imagen.png"/>
          <button type="button" class="file-picker" data-type="imagevideo" data-target="img">Elegir…</button>
        </div>
      </figure>
      <figure class="token">
        <figcaption>Token (mapa)</figcaption>
        <img src="{{document.prototypeToken.texture.src}}" alt="Token"/>
        <div class="row">
          <input type="text" name="prototypeToken.texture.src" value="{{document.prototypeToken.texture.src}}" placeholder="ruta/token.png"/>
          <button type="button" class="file-picker" data-type="imagevideo" data-target="prototypeToken.texture.src">Elegir…</button>
        </div>
      </figure>
    </div>

    <div class="id-fields">
      <label>Nombre
        <input type="text" name="name" value="{{document.name}}"/>
      </label>
      <div class="grid grid-3">
        <label>Origen (tipo)
          <select name="system.identity.origin.type">
            {{#each originTypes as |t|}}
              <option value="{{t}}" {{#if (eq t ../originSelected.type)}}selected{{/if}}>{{t}}</option>
            {{/each}}
          </select>
        </label>
        <label>Origen (subtipo)
          <select name="system.identity.origin.subtype">
            {{#each originSubtypes as |s|}}
              <option value="{{s}}" {{#if (eq s ../originSelected.subtype)}}selected{{/if}}>{{s}}</option>
            {{/each}}
          </select>
        </label>
        <label>Edad
          <input type="number" min="0" name="system.identity.age" value="{{system.identity.age}}"/>
        </label>
      </div>
    </div>
  </header>

  <div class="grid two">
    <div class="card">
      <h2>Objetivo</h2>
      <textarea name="system.identity.goal" rows="3">{{system.identity.goal}}</textarea>
    </div>
    <div class="card">
      <h2>Defectos</h2>
      <label>Físicos
        <textarea name="system.identity.flaws.physical" rows="2">{{system.identity.flaws.physical}}</textarea>
      </label>
      <label>Mentales
        <textarea name="system.identity.flaws.mental" rows="2">{{system.identity.flaws.mental}}</textarea>
      </label>
    </div>
  </div>

  <div class="grid three">
    <div class="card">
      <h2>Nivel & Experiencia</h2>
      <div class="grid grid-3">
        <label>Nivel
          <input type="number" min="1" name="system.details.level" value="{{level}}" />
        </label>
        <label>Experiencia
          <input type="number" min="0" name="system.details.xp" value="{{system.details.xp}}"/>
        </label>
        <div class="helper">XP a siguiente: {{xpToNext}}</div>
      </div>
      <div class="helper">Experticia sugerida por nivel: {{experticiaSugerida}}</div>
    </div>

    <div class="card">
      <h2>Puntos entrenables</h2>
      <div class="grid grid-2">
        <label>Actuales
          <input type="number" min="0" name="system.attributes.points.current" value="{{points.current}}"/>
        </label>
        <label>Máximo
          <input type="number" min="0" name="system.attributes.points.max" value="{{points.max}}"/>
        </label>
      </div>
    </div>

    <div class="card">
      <h2>Bonos por Origen (atributos)</h2>
      <div class="grid grid-3 tiny">
        {{#each originBonuses as |v k|}}
          <div class="pill">{{cap k}}: {{v}}</div>
        {{/each}}
        {{#unless originBonuses}}<div class="helper">Selecciona tipo y subtipo.</div>{{/unless}}
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Atributos</h2>
    <div class="attr-grid">
      {{#each attr.totals as |total key|}}
        <div class="attr-row">
          <div class="attr-name">{{cap key}}</div>
          <div class="attr-cell">
            <span class="muted">Base</span>
            <input type="number" name="system.attributes.base.{{key}}" value="{{../attr.base.[key]}}"/>
          </div>
          <div class="attr-cell">
            <span class="muted">Origen</span>
            <input type="number" value="{{lookup ../originBonuses key}}" disabled/>
          </div>
          <div class="attr-cell">
            <span class="muted">Entrenado</span>
            <input type="number" name="system.attributes.trained.{{key}}" value="{{../attr.trained.[key]}}"/>
          </div>
          <div class="attr-cell total">
            <span class="muted">Total</span>
            <input type="number" value="{{total}}" disabled/>
          </div>
          <div class="attr-cell bonus">
            <span class="muted">Bono</span>
            <input type="number" value="{{lookup ../attr.bonus key}}" disabled/>
          </div>
        </div>
      {{/each}}
    </div>
  </div>
</section>
</form>
